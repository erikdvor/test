<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>T√Ωmov√° Kasa</title>
  
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="T√Ωmov√° Kasa">
  
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <style>
    .no-scrollbar::-webkit-scrollbar { display: none; }
    .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    body { background-color: #0f172a; margin: 0; padding: 0; }
    
    /* P≈ôidan√© styly pro 3D otoƒçnou kartu */
    .perspective-1000 { perspective: 1000px; }
    .transform-style-3d { transform-style: preserve-3d; }
    .backface-hidden { backface-visibility: hidden; }
    .rotate-y-180 { transform: rotateY(180deg); }
  </style>
</head>
<body class="flex justify-center items-center min-h-screen">
  <div id="root" class="w-full h-full max-w-md bg-slate-50 relative flex flex-col font-sans sm:rounded-[2.5rem] sm:border-[8px] sm:border-slate-800 sm:shadow-2xl overflow-hidden sm:h-[800px] sm:my-10"></div>

  <script type="text/babel">
    const { useState, useEffect } = React;

    const initialFines = [
      { id: 1, name: 'Svatba', amount: 2000, icon: 'üíç' },
      { id: 2, name: 'Narozeniny', amount: 500, icon: 'üéÇ' },
      { id: 3, name: 'Pozdn√≠ p≈ô√≠chod', amount: 50, icon: '‚è∞' },
      { id: 4, name: 'Zapomenut√Ω dres', amount: 100, icon: 'üëï' },
      { id: 5, name: '≈Ωlut√° karta', amount: 200, icon: 'üü®' },
      { id: 6, name: 'ƒåerven√° karta', amount: 500, icon: 'üü•' },
      { id: 7, name: 'Nov√° kopaƒçky', amount: 300, icon: 'üëü' },
    ];

    const initialMembers = [
      { id: 1, name: 'Jan Nov√°k', owed: 250, paid: 1000, debtDate: Date.now() - 86400000 * 2 },
      { id: 2, name: 'Petr Svoboda', owed: 0, paid: 2500, debtDate: null },
      { id: 3, name: 'Tom√°≈° Dvo≈ô√°k', owed: 2000, paid: 500, debtDate: Date.now() - 86400000 * 14 },
      { id: 4, name: 'Luk√°≈° ƒåern√Ω', owed: 100, paid: 800, debtDate: Date.now() - 3600000 * 5 },
      { id: 5, name: 'Martin Vesel√Ω', owed: 0, paid: 1200, debtDate: null },
    ];

    const initialHistory = [
      { id: 101, memberId: 1, memberName: 'Jan Nov√°k', fineName: '≈Ωlut√° karta', amount: 200, date: 'Dnes 14:30', type: 'fine' },
      { id: 102, memberId: 3, memberName: 'Tom√°≈° Dvo≈ô√°k', fineName: 'Svatba', amount: 2000, date: 'Vƒçera 18:15', type: 'fine' },
      { id: 103, memberId: 2, memberName: 'Petr Svoboda', fineName: '√öhrada dluhu', amount: 500, date: '20. √∫no', type: 'payment' },
    ];

    function App() {
      const [activeTab, setActiveTab] = useState('home');
      
      const [members, setMembers] = useState(() => {
        try { const item = window.localStorage.getItem('teamKasa_members'); return item ? JSON.parse(item) : initialMembers; } 
        catch (e) { return initialMembers; }
      });
      
      const [fines, setFines] = useState(() => {
        try { const item = window.localStorage.getItem('teamKasa_fines'); return item ? JSON.parse(item) : initialFines; } 
        catch (e) { return initialFines; }
      });
      
      const [history, setHistory] = useState(() => {
        try { const item = window.localStorage.getItem('teamKasa_history'); return item ? JSON.parse(item) : initialHistory; } 
        catch (e) { return initialHistory; }
      });

      const [expenses, setExpenses] = useState(() => {
        try { const item = window.localStorage.getItem('teamKasa_expenses'); return item ? JSON.parse(item) : []; } 
        catch (e) { return []; }
      });

      const [qrCodeImage, setQrCodeImage] = useState(() => {
        try { return window.localStorage.getItem('teamKasa_qr') || null; } 
        catch (e) { return null; }
      });

      useEffect(() => { window.localStorage.setItem('teamKasa_members', JSON.stringify(members)); }, [members]);
      useEffect(() => { window.localStorage.setItem('teamKasa_fines', JSON.stringify(fines)); }, [fines]);
      useEffect(() => { window.localStorage.setItem('teamKasa_history', JSON.stringify(history)); }, [history]);
      useEffect(() => { window.localStorage.setItem('teamKasa_expenses', JSON.stringify(expenses)); }, [expenses]);
      
      useEffect(() => { 
        if (qrCodeImage) {
          window.localStorage.setItem('teamKasa_qr', qrCodeImage);
        } else {
          window.localStorage.removeItem('teamKasa_qr');
        }
      }, [qrCodeImage]);
      
      const [isAddModalOpen, setIsAddModalOpen] = useState(false);
      const [isQuickPayModalOpen, setIsQuickPayModalOpen] = useState(false);
      const [isExpenseModalOpen, setIsExpenseModalOpen] = useState(false);
      const [selectedMember, setSelectedMember] = useState(null);
      const [membersFilter, setMembersFilter] = useState('all');

      const [payingMember, setPayingMember] = useState(null);
      const [payAmount, setPayAmount] = useState(0);

      const [expenseName, setExpenseName] = useState('');
      const [expenseAmount, setExpenseAmount] = useState('');

      // STAV PRO POƒåET OTOƒåEN√ç KARTY (Pro cyklov√°n√≠ 3 stav≈Ø)
      const [flipCount, setFlipCount] = useState(0);

      // V√Ωpoƒçet index≈Ø pro l√≠c a rub, aby nedoch√°zelo k problik√°v√°n√≠ obsahu bƒõhem ot√°ƒçen√≠
      const sideAIndex = Math.floor(flipCount / 2) * 2;
      const sideBIndex = flipCount === 0 ? 1 : Math.floor((flipCount - 1) / 2) * 2 + 1;

      const formatDebtAge = (timestamp) => {
        if (!timestamp) return '';
        const diffDays = Math.floor((Date.now() - timestamp) / (1000 * 60 * 60 * 24));
        if (diffDays === 0) return 'Dnes';
        if (diffDays === 1) return 'Vƒçera';
        return `P≈ôed ${diffDays} dny`;
      };

      const totalCollected = members.reduce((sum, m) => sum + m.paid, 0); 
      const totalExpenses = expenses.reduce((sum, e) => sum + e.amount, 0); 
      const totalInBank = totalCollected - totalExpenses; 
      const totalOwed = members.reduce((sum, m) => sum + m.owed, 0); 
      
      const totalExpected = totalCollected + totalOwed; 
      const collectionRate = totalExpected > 0 ? Math.round((totalCollected / totalExpected) * 100) : 0;
      
      const topPaidMembers = [...members].sort((a, b) => b.paid - a.paid);

      const maxChartValue = Math.max(totalCollected, totalExpenses, totalOwed, 1);

      const handleAddFine = (memberId, fine) => {
        setMembers(members.map(m => {
          if (m.id === memberId) {
            return { ...m, owed: m.owed + fine.amount, debtDate: m.owed === 0 ? Date.now() : m.debtDate };
          }
          return m;
        }));
        
        const member = members.find(m => m.id === memberId);
        setHistory([{
          id: Date.now(),
          memberId: member.id,
          memberName: member.name,
          fineName: fine.name,
          amount: fine.amount,
          date: 'Pr√°vƒõ teƒè',
          type: 'fine'
        }, ...history]);

        setIsAddModalOpen(false);
        setSelectedMember(null);
      };

      const openPayModal = (member) => {
        setPayingMember(member);
        setPayAmount(member.owed);
      };

      const confirmPayment = () => {
        if (!payingMember || payAmount <= 0) return;

        setMembers(members.map(m => {
          if (m.id === payingMember.id) {
            const newOwed = m.owed - payAmount;
            return { 
              ...m, 
              paid: m.paid + payAmount, 
              owed: newOwed, 
              debtDate: newOwed === 0 ? null : m.debtDate 
            };
          }
          return m;
        }));

        setHistory([{
          id: Date.now(),
          memberId: payingMember.id,
          memberName: payingMember.name,
          fineName: payAmount === payingMember.owed ? '√öhrada dluhu' : 'ƒå√°steƒçn√° √∫hrada',
          amount: payAmount,
          date: 'Pr√°vƒõ teƒè',
          type: 'payment'
        }, ...history]);

        setPayingMember(null);
      };

      const handleAddExpense = (e) => {
        e.preventDefault();
        const amount = Number(expenseAmount);
        if (!expenseName || amount <= 0) return;

        const newExpense = {
          id: Date.now(),
          name: expenseName,
          amount: amount,
          date: new Date().toISOString()
        };

        setExpenses([newExpense, ...expenses]);

        setHistory([{
          id: Date.now() + 1,
          memberId: 'team',
          memberName: 'V√Ωdaj z kasy',
          fineName: expenseName,
          amount: amount,
          date: 'Pr√°vƒõ teƒè',
          type: 'expense'
        }, ...history]);

        setIsExpenseModalOpen(false);
        setExpenseName('');
        setExpenseAmount('');
      };

      const handleQrUpload = (e) => {
        const file = e.target.files[0];
        if (file) {
          const reader = new FileReader();
          reader.onloadend = () => setQrCodeImage(reader.result);
          reader.readAsDataURL(file);
        }
      };

      // --- RENDEROV√ÅN√ç 3 TV√Å≈ò√ç KARTY ---
      const renderCardFace = (index) => {
        const stateIndex = index % 3;

        // TV√Å≈ò 0: Z≈Østatek
        if (stateIndex === 0) {
          return (
            <div className="w-full h-full bg-gradient-to-br from-blue-600 to-indigo-700 rounded-3xl p-6 text-white shadow-xl shadow-blue-200/50 flex flex-col justify-between">
              <div className="absolute top-5 right-5 text-white/40">
                <i className="fas fa-sync-alt"></i>
              </div>
              <div>
                <div className="flex items-center space-x-2 opacity-80 mb-1">
                  <i className="fas fa-money-bill-wave"></i>
                  <span className="font-medium text-sm">Aktu√°lnƒõ v kase</span>
                </div>
                <div className="text-4xl font-black tracking-tight mb-3">
                  {totalInBank.toLocaleString('cs-CZ')} Kƒç
                </div>
              </div>
              
              <div className="bg-white/10 rounded-2xl p-3 flex justify-between items-center backdrop-blur-sm border border-white/10 mb-2">
                <div>
                  <div className="text-blue-100 text-xs font-medium mb-1">T√Ωm aktu√°lnƒõ dlu≈æ√≠</div>
                  <div className="text-xl font-bold">{totalOwed.toLocaleString('cs-CZ')} Kƒç</div>
                </div>
                <div className="h-10 w-10 bg-red-400/20 rounded-full flex items-center justify-center text-red-200">
                  <i className="fas fa-exclamation-triangle"></i>
                </div>
              </div>

              <div>
                <div className="flex justify-between text-xs font-medium text-blue-100 mb-2">
                  <span>√öspƒõ≈°nost v√Ωbƒõru</span>
                  <span className="font-bold text-white">{collectionRate} %</span>
                </div>
                <div className="w-full bg-black/20 rounded-full h-2">
                  <div className="bg-green-400 h-2 rounded-full transition-all duration-1000" style={{ width: `${collectionRate}%` }}></div>
                </div>
                <div className="flex justify-between text-[10px] text-blue-200/70 mt-1">
                  <span>Vybr√°no od t√Ωmu: {totalCollected.toLocaleString('cs-CZ')}</span>
                  <span>C√≠l: {totalExpected.toLocaleString('cs-CZ')} Kƒç</span>
                </div>
              </div>
            </div>
          );
        }

        // TV√Å≈ò 1: QR K√≥d (Nyn√≠ na druh√©m m√≠stƒõ)
        if (stateIndex === 1) {
          return (
            <div className="w-full h-full bg-white rounded-3xl p-5 shadow-xl shadow-slate-200/50 border border-slate-100 flex flex-col items-center justify-center relative">
              <div className="absolute top-5 right-5 text-slate-300">
                <i className="fas fa-sync-alt"></i>
              </div>
              
              {qrCodeImage ? (
                <div className="flex flex-col items-center justify-center h-full w-full">
                  <h3 className="font-bold text-slate-800 text-sm mb-1 absolute top-5 left-6">Platba QR k√≥dem</h3>
                  <img src={qrCodeImage} alt="QR" className="h-[130px] object-contain mb-3 mt-4" />
                  <div className="flex gap-2 w-full px-1">
                     <label 
                       className="flex-1 bg-slate-50 text-slate-600 font-bold py-2.5 rounded-xl text-xs text-center cursor-pointer border border-slate-100 hover:bg-slate-100 transition"
                       onClick={e => e.stopPropagation()}
                     >
                       <i className="fas fa-sync-alt mr-1"></i> Zmƒõnit
                       <input type="file" className="hidden" accept="image/*" onChange={handleQrUpload} />
                     </label>
                     <button 
                       onClick={(e) => { e.stopPropagation(); setQrCodeImage(null); }} 
                       className="flex-1 bg-red-50 text-red-500 font-bold py-2.5 rounded-xl text-xs border border-red-100 hover:bg-red-100 transition"
                     >
                       <i className="fas fa-trash mr-1"></i> Smazat
                     </button>
                  </div>
                </div>
              ) : (
                <div className="flex flex-col items-center justify-center text-center px-2 w-full h-full">
                   <div className="w-14 h-14 bg-purple-100 text-purple-500 rounded-full flex items-center justify-center mb-3">
                     <i className="fas fa-qrcode text-2xl"></i>
                   </div>
                   <p className="text-sm font-bold text-slate-700 mb-1">QR k√≥d banky</p>
                   <p className="text-[11px] text-slate-500 mb-4 px-2">Nahraj obr√°zek s QR k√≥dem ze sv√©ho bankovnictv√≠.</p>
                   <label 
                     className="bg-purple-600 text-white font-bold py-2.5 px-6 rounded-xl text-xs cursor-pointer shadow-md shadow-purple-200 hover:bg-purple-700 transition w-full"
                     onClick={e => e.stopPropagation()}
                   >
                     <i className="fas fa-upload mr-1"></i> Nahr√°t QR k√≥d
                     <input type="file" className="hidden" accept="image/*" onChange={handleQrUpload} />
                   </label>
                </div>
              )}
            </div>
          );
        }

        // TV√Å≈ò 2: Graf (Nyn√≠ na t≈ôet√≠m m√≠stƒõ)
        if (stateIndex === 2) {
          return (
            <div className="w-full h-full bg-white rounded-3xl p-6 shadow-xl shadow-slate-200/50 border border-slate-100 flex flex-col">
              <div className="absolute top-5 right-5 text-slate-300">
                <i className="fas fa-sync-alt"></i>
              </div>
              <h3 className="font-bold text-slate-800 text-lg mb-1">P≈ôehled financ√≠</h3>
              
              <div className="flex-1 mt-1 flex justify-around items-end border-b border-slate-100 pb-2">
                <div className="flex flex-col items-center w-1/3 h-full justify-end">
                  <span className="text-[10px] sm:text-xs font-bold text-slate-500 mb-1">{totalCollected.toLocaleString('cs-CZ')} Kƒç</span>
                  <div className="w-8 sm:w-10 bg-green-400 rounded-t-lg shadow-sm transition-all duration-1000" style={{ height: `${(totalCollected / maxChartValue) * 100}%`, minHeight: '4px' }}></div>
                </div>
                <div className="flex flex-col items-center w-1/3 h-full justify-end">
                  <span className="text-[10px] sm:text-xs font-bold text-slate-500 mb-1">{totalExpenses.toLocaleString('cs-CZ')} Kƒç</span>
                  <div className="w-8 sm:w-10 bg-orange-400 rounded-t-lg shadow-sm transition-all duration-1000" style={{ height: `${(totalExpenses / maxChartValue) * 100}%`, minHeight: '4px' }}></div>
                </div>
                <div className="flex flex-col items-center w-1/3 h-full justify-end">
                  <span className="text-[10px] sm:text-xs font-bold text-slate-500 mb-1">{totalOwed.toLocaleString('cs-CZ')} Kƒç</span>
                  <div className="w-8 sm:w-10 bg-red-400 rounded-t-lg shadow-sm transition-all duration-1000" style={{ height: `${(totalOwed / maxChartValue) * 100}%`, minHeight: '4px' }}></div>
                </div>
              </div>

              <div className="flex justify-around items-center pt-3">
                <span className="text-[10px] font-bold text-green-600 uppercase">P≈ô√≠jmy</span>
                <span className="text-[10px] font-bold text-orange-500 uppercase">V√Ωdaje</span>
                <span className="text-[10px] font-bold text-red-500 uppercase">Dluhy</span>
              </div>
            </div>
          );
        }
      };

      // --- KOMPONENTY MODAL≈Æ ---
      const AddFineModal = () => (
        <div className="fixed inset-0 bg-black/50 z-50 flex items-end sm:items-center justify-center transition-opacity animate-in fade-in duration-200">
          <div className="bg-white w-full max-w-md rounded-t-3xl sm:rounded-3xl h-[80vh] sm:h-[600px] flex flex-col shadow-2xl">
            <div className="flex justify-between items-center p-5 border-b border-gray-100">
              <h2 className="text-xl font-bold text-slate-800">
                {selectedMember ? `Pokuta pro: ${selectedMember.name}` : 'Nov√° pokuta'}
              </h2>
              <button onClick={() => { setIsAddModalOpen(false); setSelectedMember(null); }} className="p-2 bg-slate-100 rounded-full text-slate-500 hover:bg-slate-200 transition">
                <i className="fas fa-times"></i>
              </button>
            </div>
            
            <div className="flex-1 overflow-y-auto p-4 bg-slate-50 no-scrollbar">
              {!selectedMember ? (
                <div>
                  <p className="text-sm text-slate-500 mb-3 font-medium px-1">1. Vyber h≈ô√≠≈°n√≠ka</p>
                  <div className="space-y-2">
                    {members.map(m => (
                      <button 
                        key={m.id}
                        onClick={() => setSelectedMember(m)}
                        className="w-full flex items-center p-3 bg-white rounded-xl shadow-sm border border-slate-100 active:bg-blue-50 text-left transition hover:border-blue-300"
                      >
                        <div className="w-10 h-10 rounded-full bg-blue-100 text-blue-600 flex items-center justify-center font-bold mr-3">
                          {m.name.split(' ').map(n => n[0]).join('')}
                        </div>
                        <span className="font-semibold text-slate-700">{m.name}</span>
                      </button>
                    ))}
                  </div>
                </div>
              ) : (
                <div>
                  <p className="text-sm text-slate-500 mb-3 font-medium px-1">2. Vyber pokutu</p>
                  <div className="grid grid-cols-2 gap-3">
                    {fines.map(fine => (
                      <button
                        key={fine.id}
                        onClick={() => handleAddFine(selectedMember.id, fine)}
                        className="flex flex-col items-center justify-center p-4 bg-white rounded-2xl shadow-sm border border-slate-100 hover:border-blue-300 active:scale-95 transition"
                      >
                        <span className="text-3xl mb-2">{fine.icon}</span>
                        <span className="font-medium text-slate-700 text-sm text-center line-clamp-1">{fine.name}</span>
                        <span className="text-blue-600 font-bold mt-1">{fine.amount} Kƒç</span>
                      </button>
                    ))}
                  </div>
                </div>
              )}
            </div>
          </div>
        </div>
      );

      const QuickPayModal = () => (
        <div className="fixed inset-0 bg-black/50 z-50 flex items-end sm:items-center justify-center transition-opacity animate-in fade-in duration-200">
          <div className="bg-white w-full max-w-md rounded-t-3xl sm:rounded-3xl h-[60vh] sm:h-[500px] flex flex-col shadow-2xl">
            <div className="flex justify-between items-center p-5 border-b border-gray-100">
              <h2 className="text-xl font-bold text-slate-800">Kdo jde platit?</h2>
              <button onClick={() => setIsQuickPayModalOpen(false)} className="p-2 bg-slate-100 rounded-full text-slate-500 hover:bg-slate-200 transition">
                <i className="fas fa-times"></i>
              </button>
            </div>
            
            <div className="flex-1 overflow-y-auto p-4 bg-slate-50 no-scrollbar space-y-2">
              {members.filter(m => m.owed > 0).map(m => (
                <button 
                  key={m.id}
                  onClick={() => {
                    setIsQuickPayModalOpen(false);
                    openPayModal(m);
                  }}
                  className="w-full flex items-center justify-between p-4 bg-white rounded-xl shadow-sm border border-slate-100 active:bg-green-50 transition hover:border-green-300 group"
                >
                  <div className="flex items-center">
                    <div className="w-10 h-10 rounded-full bg-slate-100 text-slate-600 flex items-center justify-center font-bold mr-3 group-active:bg-green-100 group-active:text-green-600 transition">
                      {m.name.split(' ').map(n => n[0]).join('')}
                    </div>
                    <div className="text-left">
                      <span className="font-semibold text-slate-700 block">{m.name}</span>
                      <span className="text-xs text-red-400 font-medium">Dlu≈æ√≠ {m.owed} Kƒç</span>
                    </div>
                  </div>
                  <i className="fas fa-chevron-right text-slate-300"></i>
                </button>
              ))}
              
              {members.filter(m => m.owed > 0).length === 0 && (
                <div className="text-center py-10">
                  <div className="w-16 h-16 bg-green-50 rounded-full flex items-center justify-center mx-auto mb-4">
                    <i className="fas fa-check text-green-500 text-2xl"></i>
                  </div>
                  <p className="font-bold text-slate-700 text-lg">Nikdo nic nedlu≈æ√≠!</p>
                  <p className="text-slate-400 text-sm mt-1">V≈°ichni maj√≠ vzornƒõ zaplaceno.</p>
                </div>
              )}
            </div>
          </div>
        </div>
      );

      const PayDebtModal = () => {
        if (!payingMember) return null;
        return (
          <div className="fixed inset-0 bg-black/50 z-50 flex items-end sm:items-center justify-center transition-opacity animate-in fade-in duration-200">
            <div className="bg-white w-full max-w-md rounded-t-3xl sm:rounded-3xl p-6 flex flex-col shadow-2xl">
              <div className="flex justify-between items-center mb-6">
                <h2 className="text-xl font-bold text-slate-800">Uhradit dluh</h2>
                <button onClick={() => setPayingMember(null)} className="p-2 bg-slate-100 rounded-full text-slate-500 hover:bg-slate-200 transition">
                  <i className="fas fa-times"></i>
                </button>
              </div>
              
              <div className="text-center mb-8">
                <div className="w-20 h-20 rounded-full bg-slate-100 text-slate-600 flex items-center justify-center font-bold text-3xl mx-auto mb-3 border-4 border-white shadow-md">
                  {payingMember.name.split(' ').map(n => n[0]).join('')}
                </div>
                <h3 className="font-bold text-2xl text-slate-800">{payingMember.name}</h3>
                <p className="text-slate-500 font-medium mt-1">Celkov√Ω dluh: <span className="font-bold text-red-500">{payingMember.owed} Kƒç</span></p>
              </div>

              <div className="mb-10 bg-slate-50 p-5 rounded-2xl border border-slate-100">
                <div className="flex justify-between items-end mb-4">
                  <span className="text-sm font-bold text-slate-500">ƒå√°stka k √∫hradƒõ:</span>
                  <span className="text-4xl font-black text-green-600">{payAmount} Kƒç</span>
                </div>
                
                <input 
                  type="range" 
                  min="1" 
                  max={payingMember.owed} 
                  value={payAmount}
                  onChange={(e) => setPayAmount(Number(e.target.value))}
                  className="w-full h-3 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-green-500"
                />
                
                <div className="flex justify-between text-xs text-slate-400 mt-3 font-bold">
                  <span>1 Kƒç</span>
                  <span>{payingMember.owed} Kƒç</span>
                </div>
              </div>

              <button 
                onClick={confirmPayment}
                className="w-full bg-green-500 text-white font-bold py-4 rounded-2xl shadow-lg shadow-green-200 active:scale-95 transition-transform text-lg flex justify-center items-center"
              >
                <i className="fas fa-check-circle mr-2"></i> Potvrdit platbu
              </button>
            </div>
          </div>
        );
      };

      const ExpenseModal = () => (
        <div className="fixed inset-0 bg-black/50 z-50 flex items-end sm:items-center justify-center transition-opacity animate-in fade-in duration-200">
          <div className="bg-white w-full max-w-md rounded-t-3xl sm:rounded-3xl p-6 flex flex-col shadow-2xl">
            <div className="flex justify-between items-center mb-6">
              <h2 className="text-xl font-bold text-slate-800">Nov√Ω v√Ωdaj z kasy</h2>
              <button onClick={() => setIsExpenseModalOpen(false)} className="p-2 bg-slate-100 rounded-full text-slate-500 hover:bg-slate-200 transition">
                <i className="fas fa-times"></i>
              </button>
            </div>
            
            <form onSubmit={handleAddExpense} className="space-y-4 mb-4">
              <div>
                <label className="block text-sm font-bold text-slate-500 mb-1">Za co se platilo?</label>
                <input 
                  type="text" 
                  placeholder="Nap≈ô. T√Ωmov√° veƒçe≈ôe, M√≠ƒçe..." 
                  value={expenseName}
                  onChange={(e) => setExpenseName(e.target.value)}
                  className="w-full bg-slate-50 border border-slate-200 rounded-xl p-4 font-medium text-slate-800 focus:outline-none focus:ring-2 focus:ring-orange-500"
                  required
                />
              </div>
              <div>
                <label className="block text-sm font-bold text-slate-500 mb-1">ƒå√°stka (Kƒç)</label>
                <input 
                  type="number" 
                  min="1"
                  placeholder="0" 
                  value={expenseAmount}
                  onChange={(e) => setExpenseAmount(e.target.value)}
                  className="w-full bg-slate-50 border border-slate-200 rounded-xl p-4 font-black text-slate-800 text-xl focus:outline-none focus:ring-2 focus:ring-orange-500"
                  required
                />
              </div>
              
              {Number(expenseAmount) > totalInBank && (
                <div className="bg-red-50 text-red-600 p-3 rounded-lg text-xs font-bold flex items-center">
                  <i className="fas fa-exclamation-triangle mr-2 text-lg"></i>
                  <span>Pozor, vyb√≠r√°≈° v√≠c, ne≈æ je aktu√°lnƒõ v kase! Jde≈° do m√≠nusu.</span>
                </div>
              )}

              <button 
                type="submit"
                className="w-full bg-orange-500 text-white font-bold py-4 rounded-xl shadow-lg shadow-orange-200 active:scale-95 transition-transform text-lg mt-4 flex justify-center items-center"
              >
                <i className="fas fa-shopping-cart mr-2"></i> Zaznamenat v√Ωdaj
              </button>
            </form>
          </div>
        </div>
      );

      return (
        <>
          {/* HEADER */}
          <div className="bg-white pt-12 pb-4 px-6 rounded-b-3xl shadow-sm z-10 w-full sticky top-0 flex justify-between items-center">
            <h1 className="text-2xl font-extrabold text-slate-800 tracking-tight">
              {activeTab === 'home' && 'T√Ωmov√° Kasa'}
              {activeTab === 'leaderboard' && 'S√≠≈à sl√°vy'}
              {activeTab === 'members' && 'Seznam hr√°ƒç≈Ø'}
              {activeTab === 'fines' && 'Sazebn√≠k pokut'}
            </h1>
            {activeTab === 'home' && (
              <div className="w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center">
                <i className="fas fa-wallet text-blue-600 text-sm"></i>
              </div>
            )}
          </div>

          {/* CONTENT AREA */}
          <div className="flex-1 overflow-y-auto w-full pb-24 no-scrollbar">
            
            {activeTab === 'home' && (
              <div className="p-5 space-y-6">
                
                {/* OSOBN√ç UV√çT√ÅN√ç */}
                <div className="flex items-center justify-between mb-2">
                  <div>
                    <h2 className="text-xs font-bold text-slate-400 uppercase tracking-wider mb-1">Dne≈°n√≠ p≈ôehled</h2>
                    <h3 className="text-xl font-black text-slate-800">Ahoj, Pokladn√≠ku üëã</h3>
                  </div>
                </div>

                {/* HLAVN√ç OTOƒåN√Å KARTA (3 STRANY) */}
                <div 
                  className="perspective-1000 w-full h-[280px] cursor-pointer"
                  onClick={() => setFlipCount(f => f + 1)}
                >
                  <div className="relative w-full h-full transition-transform duration-700 transform-style-3d" style={{ transform: `rotateY(${flipCount * 180}deg)` }}>
                    
                    {/* DOM pro L√≠c (rotace 0, 360, 720...) */}
                    <div className="absolute top-0 left-0 w-full h-full backface-hidden">
                      {renderCardFace(sideAIndex)}
                    </div>

                    {/* DOM pro Rub (rotace 180, 540, 900...) */}
                    <div className="absolute top-0 left-0 w-full h-full backface-hidden rotate-y-180">
                      {renderCardFace(sideBIndex)}
                    </div>
                  </div>
                </div>

                {/* QUICK ACTIONS - POUZE 3 TLAƒå√çTKA */}
                <div className="flex justify-between gap-3 py-2">
                  <button 
                    onClick={() => setIsAddModalOpen(true)}
                    className="flex-1 flex flex-col items-center justify-center py-3 bg-white rounded-3xl shadow-sm border border-slate-100 group hover:border-blue-200 active:bg-slate-50 transition"
                  >
                    <div className="w-12 h-12 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center mb-2 group-active:scale-95 transition-transform">
                      <i className="fas fa-plus text-lg"></i>
                    </div>
                    <span className="font-bold text-slate-700 text-[11px] uppercase tracking-wide">Pokuta</span>
                  </button>
                  
                  <button 
                    onClick={() => setIsQuickPayModalOpen(true)}
                    className="flex-1 flex flex-col items-center justify-center py-3 bg-white rounded-3xl shadow-sm border border-slate-100 group hover:border-green-200 active:bg-slate-50 transition"
                  >
                    <div className="w-12 h-12 bg-green-100 text-green-600 rounded-full flex items-center justify-center mb-2 group-active:scale-95 transition-transform">
                      <i className="fas fa-check text-lg"></i>
                    </div>
                    <span className="font-bold text-slate-700 text-[11px] uppercase tracking-wide">Uhradit</span>
                  </button>

                  <button 
                    onClick={() => setIsExpenseModalOpen(true)}
                    className="flex-1 flex flex-col items-center justify-center py-3 bg-white rounded-3xl shadow-sm border border-slate-100 group hover:border-orange-200 active:bg-slate-50 transition"
                  >
                    <div className="w-12 h-12 bg-orange-100 text-orange-600 rounded-full flex items-center justify-center mb-2 group-active:scale-95 transition-transform">
                      <i className="fas fa-shopping-cart text-lg"></i>
                    </div>
                    <span className="font-bold text-slate-700 text-[11px] uppercase tracking-wide">V√Ωdaj</span>
                  </button>
                </div>

                {/* HISTORIE */}
                <div>
                  <div className="flex items-center justify-between mb-4 px-1">
                    <h3 className="font-bold text-slate-800 text-lg">Posledn√≠ akce</h3>
                  </div>

                  <div className="space-y-3">
                    {history.slice(0, 4).map(item => (
                      <div key={item.id} className="bg-white p-4 rounded-2xl shadow-sm border border-slate-100 flex items-center justify-between hover:bg-slate-50 transition">
                        <div className="flex items-center space-x-4">
                          <div className={`w-10 h-10 rounded-full flex items-center justify-center flex-shrink-0 ${item.type === 'fine' ? 'bg-red-50 text-red-500' : item.type === 'expense' ? 'bg-orange-50 text-orange-500' : 'bg-green-50 text-green-500'}`}>
                            {item.type === 'fine' ? <i className="fas fa-arrow-down"></i> : item.type === 'expense' ? <i className="fas fa-shopping-cart"></i> : <i className="fas fa-arrow-up"></i>}
                          </div>
                          <div>
                            <p className="font-bold text-slate-700">{item.memberName}</p>
                            <p className="text-xs text-slate-400 font-medium">{item.fineName} ‚Ä¢ {item.date}</p>
                          </div>
                        </div>
                        <div className={`font-black ${item.type === 'fine' ? 'text-slate-700' : item.type === 'expense' ? 'text-orange-500' : 'text-green-500'}`}>
                          {item.type === 'fine' ? '' : item.type === 'expense' ? '-' : '+'}{item.amount} Kƒç
                        </div>
                      </div>
                    ))}
                    {history.length === 0 && (
                      <p className="text-center text-slate-400 py-6 text-sm font-medium border-2 border-dashed border-slate-200 rounded-2xl">Zat√≠m se nic nestalo.</p>
                    )}
                  </div>
                </div>
              </div>
            )}

            {/* LEADERBOARD TAB */}
            {activeTab === 'leaderboard' && (
              <div className="p-5">
                <div className="bg-white rounded-3xl p-6 shadow-sm border border-slate-100 mb-6">
                  <p className="text-center text-slate-500 font-medium mb-6">Nejvƒõt≈°√≠ sponzo≈ôi t√Ωmov√© kasy</p>
                  
                  <div className="flex items-end justify-center gap-2 mt-4">
                    {topPaidMembers[1] && (
                      <div className="flex flex-col items-center">
                        <div className="w-12 h-12 rounded-full bg-slate-100 text-slate-500 flex items-center justify-center font-bold mb-2 shadow-sm border-2 border-slate-200">
                          {topPaidMembers[1].name.split(' ').map(n => n[0]).join('')}
                        </div>
                        <div className="w-20 h-24 bg-gradient-to-t from-slate-200 to-slate-100 rounded-t-xl flex flex-col items-center justify-start pt-2 border-t border-x border-slate-200">
                          <span className="text-2xl font-black text-slate-400">2</span>
                          <span className="text-xs font-bold text-slate-500 mt-1">{topPaidMembers[1].paid} Kƒç</span>
                        </div>
                      </div>
                    )}
                    
                    {topPaidMembers[0] && (
                      <div className="flex flex-col items-center relative z-10">
                        <i className="fas fa-trophy text-yellow-500 text-2xl mb-2 drop-shadow-sm"></i>
                        <div className="w-16 h-16 rounded-full bg-yellow-50 text-yellow-600 flex items-center justify-center font-bold text-lg mb-2 shadow-md border-2 border-yellow-300">
                          {topPaidMembers[0].name.split(' ').map(n => n[0]).join('')}
                        </div>
                        <div className="w-24 h-32 bg-gradient-to-t from-yellow-300 to-yellow-100 rounded-t-xl flex flex-col items-center justify-start pt-2 shadow-lg border-t border-x border-yellow-300">
                          <span className="text-4xl font-black text-yellow-600">1</span>
                          <span className="text-sm font-bold text-yellow-700 mt-1">{topPaidMembers[0].paid} Kƒç</span>
                        </div>
                      </div>
                    )}

                    {topPaidMembers[2] && (
                      <div className="flex flex-col items-center">
                        <div className="w-12 h-12 rounded-full bg-orange-50 text-orange-600 flex items-center justify-center font-bold mb-2 shadow-sm border-2 border-orange-200">
                          {topPaidMembers[2].name.split(' ').map(n => n[0]).join('')}
                        </div>
                        <div className="w-20 h-20 bg-gradient-to-t from-orange-200 to-orange-100 rounded-t-xl flex flex-col items-center justify-start pt-2 border-t border-x border-orange-200">
                          <span className="text-2xl font-black text-orange-400">3</span>
                          <span className="text-xs font-bold text-orange-600 mt-1">{topPaidMembers[2].paid} Kƒç</span>
                        </div>
                      </div>
                    )}
                  </div>
                </div>

                <div className="space-y-3">
                  {topPaidMembers.slice(3).map((member, index) => (
                    <div key={member.id} className="bg-white p-4 rounded-2xl shadow-sm border border-slate-100 flex items-center justify-between">
                      <div className="flex items-center space-x-4">
                        <span className="font-bold text-slate-400 w-4 text-center">{index + 4}.</span>
                        <div className="w-10 h-10 rounded-full bg-slate-50 text-slate-500 flex items-center justify-center font-bold text-sm">
                          {member.name.split(' ').map(n => n[0]).join('')}
                        </div>
                        <span className="font-semibold text-slate-700">{member.name}</span>
                      </div>
                      <span className="font-black text-slate-600">{member.paid} Kƒç</span>
                    </div>
                  ))}
                </div>
              </div>
            )}

            {/* MEMBERS TAB */}
            {activeTab === 'members' && (
              <div className="p-5 space-y-4">
                <div className="flex justify-between items-center px-1 mb-2">
                  <h2 className="font-bold text-slate-800 text-xl">T√Ωm</h2>
                  <button className="text-blue-600 flex items-center text-sm font-bold bg-blue-50 px-3 py-1.5 rounded-lg active:bg-blue-100 transition">
                    <i className="fas fa-user-plus mr-2"></i> P≈ôidat
                  </button>
                </div>

                <div className="flex space-x-2 overflow-x-auto no-scrollbar mb-2 pb-2 px-1">
                  <button
                    onClick={() => setMembersFilter('all')}
                    className={`px-4 py-1.5 rounded-full text-sm font-bold whitespace-nowrap transition-colors ${membersFilter === 'all' ? 'bg-slate-800 text-white shadow-md' : 'bg-white text-slate-500 border border-slate-200'}`}
                  >
                    V≈°ichni
                  </button>
                  <button
                    onClick={() => setMembersFilter('top_debt')}
                    className={`px-4 py-1.5 rounded-full text-sm font-bold whitespace-nowrap transition-colors ${membersFilter === 'top_debt' ? 'bg-red-500 text-white shadow-md shadow-red-200' : 'bg-white text-slate-500 border border-slate-200'}`}
                  >
                    Nejvƒõt≈°√≠ dlu≈æn√≠ci
                  </button>
                  <button
                    onClick={() => setMembersFilter('oldest_debt')}
                    className={`px-4 py-1.5 rounded-full text-sm font-bold whitespace-nowrap transition-colors ${membersFilter === 'oldest_debt' ? 'bg-orange-500 text-white shadow-md shadow-orange-200' : 'bg-white text-slate-500 border border-slate-200'}`}
                  >
                    Nejstar≈°√≠ dluhy
                  </button>
                </div>
                
                <div className="space-y-3">
                  {(() => {
                    let displayedMembers = [...members];
                    if (membersFilter === 'top_debt') {
                      displayedMembers = displayedMembers.filter(m => m.owed > 0).sort((a, b) => b.owed - a.owed);
                    } else if (membersFilter === 'oldest_debt') {
                      displayedMembers = displayedMembers.filter(m => m.owed > 0).sort((a, b) => a.debtDate - b.debtDate);
                    } else {
                      displayedMembers.sort((a, b) => b.owed - a.owed);
                    }

                    if (displayedMembers.length === 0) {
                      return (
                        <div className="text-center py-8">
                          <div className="w-12 h-12 bg-green-50 rounded-full flex items-center justify-center mx-auto mb-3">
                            <i className="fas fa-check text-green-500 text-xl"></i>
                          </div>
                          <p className="font-semibold text-slate-700">V≈°ichni maj√≠ zaplaceno!</p>
                          <p className="text-sm text-slate-400">T√Ωm m√° ƒçist√Ω ≈°t√≠t.</p>
                        </div>
                      );
                    }

                    return displayedMembers.map(member => (
                      <div key={member.id} className="bg-white p-4 rounded-2xl shadow-sm border border-slate-100 flex items-center justify-between">
                        <div className="flex items-center space-x-3">
                          <div className="w-12 h-12 rounded-full bg-slate-100 text-slate-600 flex items-center justify-center font-bold text-lg">
                            {member.name.split(' ').map(n => n[0]).join('')}
                          </div>
                          <div>
                            <p className="font-bold text-slate-800 text-lg">{member.name}</p>
                            <p className="text-xs text-slate-400 font-medium">
                              {membersFilter === 'oldest_debt' ? `Nezaplaceno: ${formatDebtAge(member.debtDate)}` : `Zaplaceno celkem: ${member.paid} Kƒç`}
                            </p>
                          </div>
                        </div>
                        
                        <div className="flex flex-col items-end">
                          {member.owed > 0 ? (
                            <>
                              <span className="font-black text-red-500 text-lg">{member.owed} Kƒç</span>
                              <span className="text-[10px] text-red-400 font-bold uppercase tracking-wider">Dlu≈æ√≠</span>
                              <button 
                                onClick={() => openPayModal(member)}
                                className="mt-2 bg-green-100 text-green-700 text-xs font-bold px-3 py-1.5 rounded-lg active:bg-green-200 transition"
                              >
                                Uhradit
                              </button>
                            </>
                          ) : (
                            <span className="bg-green-50 text-green-600 px-3 py-1.5 rounded-lg text-sm font-bold flex items-center">
                              <i className="fas fa-check mr-1 text-xs"></i> ƒåist√Ω
                            </span>
                          )}
                        </div>
                      </div>
                    ));
                  })()}
                </div>
              </div>
            )}

            {/* FINES TAB */}
            {activeTab === 'fines' && (
              <div className="p-5">
                <div className="grid grid-cols-1 gap-3">
                  {fines.map(fine => (
                    <div key={fine.id} className="bg-white p-4 rounded-2xl shadow-sm border border-slate-100 flex items-center justify-between">
                      <div className="flex items-center space-x-4">
                        <span className="text-3xl bg-slate-50 w-12 h-12 flex items-center justify-center rounded-xl">{fine.icon}</span>
                        <span className="font-semibold text-slate-800 text-lg">{fine.name}</span>
                      </div>
                      <span className="font-black text-blue-600 text-lg">{fine.amount} Kƒç</span>
                    </div>
                  ))}
                  <button className="border-2 border-dashed border-slate-300 p-4 rounded-2xl text-slate-500 font-bold flex items-center justify-center hover:bg-slate-50 transition mt-2">
                    <i className="fas fa-plus mr-2"></i> P≈ôidat novou polo≈æku
                  </button>
                </div>
              </div>
            )}
          </div>

          {/* BOTTOM TAB BAR */}
          <div className="absolute bottom-0 w-full bg-white border-t border-slate-100 px-6 py-4 pb-8 sm:pb-6 flex justify-around items-center z-20">
            <button onClick={() => setActiveTab('home')} className={`flex flex-col items-center space-y-1 w-16 transition-colors ${activeTab === 'home' ? 'text-blue-600' : 'text-slate-400 hover:text-slate-600'}`}>
              <div className={`p-2 rounded-xl ${activeTab === 'home' ? 'bg-blue-50' : ''}`}><i className="fas fa-home text-xl"></i></div>
              <span className="text-[10px] font-bold">Kasa</span>
            </button>

            <button onClick={() => setActiveTab('leaderboard')} className={`flex flex-col items-center space-y-1 w-16 transition-colors ${activeTab === 'leaderboard' ? 'text-blue-600' : 'text-slate-400 hover:text-slate-600'}`}>
              <div className={`p-2 rounded-xl ${activeTab === 'leaderboard' ? 'bg-blue-50' : ''}`}><i className="fas fa-trophy text-xl"></i></div>
              <span className="text-[10px] font-bold">≈Ωeb≈ô√≠ƒçek</span>
            </button>

            <button onClick={() => setActiveTab('members')} className={`flex flex-col items-center space-y-1 w-16 transition-colors ${activeTab === 'members' ? 'text-blue-600' : 'text-slate-400 hover:text-slate-600'}`}>
              <div className={`p-2 rounded-xl ${activeTab === 'members' ? 'bg-blue-50' : ''}`}><i className="fas fa-user-friends text-xl"></i></div>
              <span className="text-[10px] font-bold">T√Ωm</span>
            </button>

            <button onClick={() => setActiveTab('fines')} className={`flex flex-col items-center space-y-1 w-16 transition-colors ${activeTab === 'fines' ? 'text-blue-600' : 'text-slate-400 hover:text-slate-600'}`}>
               <div className={`p-2 rounded-xl ${activeTab === 'fines' ? 'bg-blue-50' : ''}`}><i className="fas fa-list text-xl"></i></div>
              <span className="text-[10px] font-bold">Sazebn√≠k</span>
            </button>
          </div>

          {/* MODALS */}
          {isAddModalOpen && <AddFineModal />}
          {isQuickPayModalOpen && <QuickPayModal />}
          {payingMember && <PayDebtModal />}
          {isExpenseModalOpen && <ExpenseModal />}
        </>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
</body>
</html>
